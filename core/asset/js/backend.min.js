function annonceOSMapInit(){annonceInitOpenStreetMap()}function annonceInitOpenStreetMap(){var n=jQuery("#annonces-map-wrapper");jQuery(n).each(function(){annonceCreateOSMap(jQuery(this))})}function annonceCreateOSMap(n){var a,e,t,r,o;null!=n&&0!=n.length&&(a=48.852969,e=2.349903,t=L.map("annonces-google-map").setView([a,e],5),r=[],o=[],L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',minZoom:1,maxZoom:20}).addTo(t),n=jQuery(n).find("marker"),jQuery(n).each(function(){annonceGetAddressAttr(jQuery(this).attr("address")).then(n=>{$marker=jQuery(this),e=0<n.length?(a=n[0].lat,n[0].lon):(a=Number(jQuery(this).attr("lat")),Number(jQuery(this).attr("lng"))),annonceCreateOSMarker(t,$marker,a,e),annonceBindPopupOSMarker(t,$marker,finalMarker),r.push(finalMarker),o.push(jQuery(this));n=new L.featureGroup(r);t.fitBounds(n.getBounds().pad(.5),{duration:.5})})}),jQuery(".annonces-taxonomies .taxonomy-label").on("click",function(){jQuery(this).hasClass("active")?(annonceDisplayOSMapMarkers(o,r,t,jQuery(this).attr("data-id").split(",")),jQuery(this).removeClass("active"),jQuery(this).next(".taxonomies-child").find(".taxonomy-label").removeClass("active")):(annonceDisplayOSMapMarkers(o,r,t,jQuery(this).attr("data-id").split(",")),jQuery(this).addClass("active"),jQuery(this).next(".taxonomies-child").find(".taxonomy-label").addClass("active"))}))}async function annonceGetAddressAttr(n){try{return await jQuery.getJSON("https://nominatim.openstreetmap.org/search?q="+n+"&format=json&polygon=1&addressdetails=1")}catch(n){console.log(n)}}async function annonceCreateOSMarker(n,a,e,t){a=null!=a.attr("pin")?annonces_data.url+"/modules/annonce/asset/img/pin-"+a.attr("pin")+".png":annonces_data.url+"/modules/annonce/asset/img/pin-red.png";a=L.icon({iconUrl:a,iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]});finalMarker=L.marker([e,t],{icon:a}).addTo(n)}function annonceBindPopupOSMarker(n,a,e){e.bindPopup(a.html())}function annonceDisplayOSMapMarkers(n,e,t,r){if(0!=e.length)for(var o=0;o<e.length;o++)n[o].attr("taxonomy").split(",").forEach(function(a){r.forEach(function(n){a==n&&(t.hasLayer(e[o])?t.removeLayer(e[o]):t.addLayer(e[o]))})})}function annonceInit(){annonceInitMap()}function annonceInitMap(){var n=jQuery("#annonces-map-wrapper");jQuery(n).each(function(){annonceCreateMap(jQuery(this))})}function annonceCreateMap(n){var e,a,t,r,o,i,s;null!=n&&0!=n.length&&(e=n,a=jQuery(e).find("marker"),o=new google.maps.LatLng(a.attr("lat"),a.attr("lng")),t=[],n={zoom:8,center:o,fullscreenControl:!(r=[])},o=e.data("map"),i=!1,s=new google.maps.Map(jQuery(e).find("#annonces-google-map")[0],jQuery.extend(n,o)),jQuery(a).each(function(){var n=annonceCreateMarker(s,jQuery(this)),a=annonceCreateInfoWindow(jQuery(this));0!=jQuery(this).html().length&&n.addListener("click",function(){i&&i.close(),(i=a).open(e,n)}),t.push(n),r.push(jQuery(this))}),jQuery(".annonces-taxonomies .taxonomy-label").on("click",function(){jQuery(this).hasClass("active")?(annonceDisplayMapMarkers(r,t,null,jQuery(this).attr("data-id").split(",")),jQuery(this).removeClass("active"),jQuery(this).next(".taxonomies-child").find(".taxonomy-label").removeClass("active")):(annonceDisplayMapMarkers(r,t,s,jQuery(this).attr("data-id").split(",")),jQuery(this).addClass("active"),jQuery(this).next(".taxonomies-child").find(".taxonomy-label").addClass("active"))}))}function annonceCreateMarker(n,a){var e=n,n=a,a={lat:Number(n.attr("lat")),lng:Number(n.attr("lng"))};return n=null!=n.attr("pin")?annonces_data.url+"/modules/annonce/asset/img/pin-"+n.attr("pin")+".png":annonces_data.url+"/modules/annonce/asset/img/pin-red.png",new google.maps.Marker({position:a,map:e,animation:google.maps.Animation.DROP,icon:n})}function annonceCreateInfoWindow(n){return new google.maps.InfoWindow({content:n.html()})}function annonceDisplayMapMarkers(n,e,t,r){for(var o=0;o<e.length;o++)n[o].attr("taxonomy").split(",").forEach(function(a){r.forEach(function(n){a==n&&e[o].setMap(t)})})}jQuery(document).ready(function(){"gmap"==annonces_data.library&&annonceInit(),"openstreetmap"==annonces_data.library&&annonceOSMapInit()});